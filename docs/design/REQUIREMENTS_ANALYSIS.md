# 📋 需求分析与数据模型设计

## 🎯 用户需求总结

### 核心需求
1. **数据导入**：从 Excel 和 Word 导入监督检查数据
2. **数据管理**：对导入的数据进行编辑、查询、删除
3. **数据分析**：按多维度进行统计分析
4. **数据导出**：导出为 Excel 报表

### 数据来源
1. **建设系统安全隐患库** (Excel)
   - 标准格式：建设部 8.7 版本
   - 包含：隐患信息、整改信息、责任单位等
   - 优先级：⭐⭐⭐ 最高

2. **监督通知书** (Word)
   - 格式：.docx 文件
   - 包含：项目信息、检查信息、问题描述、图片等
   - 优先级：⭐⭐ 中等

3. **问题类型分类** (Markdown)
   - 来源：工程质量、施工安全、管理行为等标准分类
   - 用途：后期功能扩展
   - 优先级：⏳ 后期

---

## 📊 数据分类体系

### 前期实现（3 个主类别）

#### 1. 质量问题 (Quality)
- 工程质量相关问题
- 包括：混凝土、路基、桥涵、隧道等工程质量问题

#### 2. 安全问题 (Safety)
- 施工安全相关问题
- 分为 7 个子类别：
  1. **防洪防汛** - 防洪防汛相关隐患
  2. **消防安全** - 消防防火相关隐患
  3. **隧道安全** - 隧道施工安全隐患
  4. **桥梁安全** - 桥梁施工安全隐患
  5. **劳动作业安全** - 劳动作业安全隐患
  6. **交通安全** - 交通安全隐患
  7. **营业线安全** - 邻近既有线施工安全隐患

#### 3. 管理问题 (Management)
- 管理行为相关问题
- 包括：建设、设计、施工、监理等单位的管理问题

### 后期扩展（详细分类）
- 工程质量（7 个二级类别，40+ 个三级类别）
- 施工安全（16 个二级类别）
- 管理行为（6 个二级类别，各 7 个三级类别）
- 其他

### 隐患等级（5 级）
- **1 级**：严重
- **2 级**：较重
- **3 级**：一般（默认）
- **4 级**：轻微
- **5 级**：其他

---

## 🗄️ 数据库表结构

### 核心表（6 个）

#### 1. supervision_notices（监督通知书）
- 存储监督检查通知书的基本信息
- 关键字段：编号、检查时间、检查单位、检查人员、统计数据

#### 2. projects（项目）
- 存储工程项目信息
- 关键字段：项目名称、标段、参建单位

#### 3. inspection_points（工点）
- 存储检查工点信息
- 关键字段：工点名称、位置、检查时间、检查人员

#### 4. issues（隐患问题）
- 存储隐患问题信息
- 关键字段：隐患编号、描述、分类、等级、整改信息

#### 5. responsibility_units（责任单位）
- 存储隐患的责任单位和责任人
- 关键字段：单位类型、单位名称、责任人

#### 6. issue_images（问题图片）
- 存储隐患相关的图片
- 关键字段：图片路径、图片顺序、描述

### 数据关系

```
supervision_notices (1)
    ↓ 1:N
projects (1)
    ↓ 1:N
inspection_points (1)
    ↓ 1:N
issues (1)
    ├─ 1:N → issue_images
    └─ 1:N → responsibility_units
```

---

## 📥 数据导入流程

### Excel 导入（优先级最高）

```
Excel 文件
    ↓
验证文件格式和表头
    ↓
逐行读取数据
    ↓
数据验证和清洗
    ├─ 检查必填字段
    ├─ 验证数据类型
    ├─ 验证业务规则
    └─ 检查数据去重
    ↓
映射到数据库表
    ├─ supervision_notices
    ├─ projects
    ├─ inspection_points
    ├─ issues
    └─ responsibility_units
    ↓
保存到数据库
    ↓
生成导入报告
```

### Word 导入（后期实现）

```
Word 文档
    ↓
提取文本和图片
    ↓
正则表达式提取基础信息
    ├─ 编号、检查时间、检查人员
    ├─ 项目名称、标段、工点
    └─ 问题统计
    ↓
NLP 模型提取关键实体
    ├─ 单位名称
    ├─ 问题类型
    └─ 问题描述
    ↓
人工审核和修正
    ↓
保存到数据库
```

---

## 🔄 数据字段映射

### Excel → 数据库

| Excel 字段 | 数据库表 | 数据库字段 | 说明 |
|-----------|--------|----------|------|
| 序号 | issues | issue_number | 隐患编号 |
| 检查时间 | supervision_notices | check_date | 检查日期 |
| 检查单位 | supervision_notices | check_unit | 检查机构 |
| 检查人 | supervision_notices | check_personnel | 检查人员 |
| 检查项目 | projects | project_name | 项目名称 |
| 检查工点 | inspection_points | point_name | 工点名称 |
| 隐患问题描述 | issues | description | 问题描述 |
| 隐患类型 | issues | issue_type | 隐患类型 |
| 隐患等级 | issues | severity | 隐患等级 |
| 整改要求 | issues | rectification_measures | 整改措施 |
| 整改期限 | issues | deadline | 整改期限 |
| 整改责任单位 | responsibility_units | unit_type | 单位类型 |
| 整改责任人 | responsibility_units | responsible_person | 责任人 |
| 整改完成日期 | issues | completion_date | 完成日期 |
| 销号情况 | issues | completion_status | 销号状态 |

---

## 🚀 实现阶段

### Phase 1：数据库和基础 API（第 1-2 周）
- ✅ 创建数据库表结构
- ✅ 实现基础 CRUD API
- ✅ 实现数据验证

### Phase 2：Excel 导入（第 2-3 周）
- ⭐ 实现 Excel 文件读取
- ⭐ 实现数据提取和验证
- ⭐ 实现数据保存
- ⭐ 实现导入报告

### Phase 3：前端界面（第 3-4 周）
- ⭐ 实现数据列表页面
- ⭐ 实现数据编辑页面
- ⭐ 实现导入页面
- ⭐ 实现查询和搜索

### Phase 4：数据分析（第 4-5 周）
- 📋 实现统计分析
- 📋 实现数据可视化
- 📋 实现 Excel 导出

### Phase 5：Word 导入（第 5-6 周）
- 📋 实现 Word 文档解析
- 📋 实现正则表达式提取
- 📋 实现 NLP 模型集成
- 📋 实现人工审核界面

---

## 📝 关键设计决策

### 1. 数据分类体系
- **前期**：3 个主类别 + 7 个安全子类别
- **后期**：详细的 3 层分类体系
- **优势**：简单易用，易于扩展

### 2. 隐患等级
- **默认值**：3 级（一般）
- **范围**：1-5 级
- **优势**：符合建设部标准

### 3. 数据去重
- **通知书**：按编号去重
- **项目**：按名称+标段去重
- **工点**：按名称+项目去重
- **隐患**：按编号去重

### 4. 导入优先级
- **最高**：Excel 导入（标准格式）
- **中等**：Word 导入（需要 NLP）
- **后期**：详细分类（功能扩展）

---

## 📚 相关文档

- **README.md** - 项目总体规划
- **DATA_MODEL_DESIGN.md** - 详细的数据模型设计
- **DATA_IMPORT_SPECIFICATION.md** - 数据导入规范
- **SAMPLE_ANALYSIS.md** - 示范文件分析
- **OPTIMIZATION_SUMMARY.md** - 项目优化总结


